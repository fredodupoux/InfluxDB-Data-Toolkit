<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfluxDB Data Toolkit</title>
    <!-- Modern Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <!-- Material Icons for UI enhancement -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar navbar-title">
        <div class="navbar-brand">
            <span class="material-icons" style="vertical-align:middle; font-size:1.3em; margin-right:6px;">data_object</span>
            InfluxDB Toolkit
        </div>
    </nav>
    <nav class="navbar navbar-menu">
        <ul class="navbar-nav">
            <li><button id="nav-export-btn" class="nav-button"><span class="material-icons nav-icon">cloud_download</span> Export Data</button></li>
            <li><button id="nav-open-file-btn" class="nav-button"><span class="material-icons nav-icon">folder_open</span> Open File</button></li>
            <li><button id="nav-clean-btn" class="nav-button" disabled><span class="material-icons nav-icon">cleaning_services</span> Clean Data</button></li>
            <li><button id="nav-reformat-btn" class="nav-button" disabled><span class="material-icons nav-icon">schedule</span> Reformat Time</button></li>
        </ul>
    </nav>

    <div class="container">
        <div id="main-content">

            <!-- Export Section (Initially Hidden) -->
            <div id="export-section" class="content-section hidden">
                <h2>Export Data from InfluxDB</h2>
                <form id="export-form">
                    <div>
                        <label for="export-days">Days to Query:</label>
                        <input type="number" id="export-days" name="days" value="3" min="1" required>
                    </div>
                    <div>
                        <label for="export-device">Device Name:</label>
                        <input type="text" id="export-device" name="device" value="WaterMeter" required>
                    </div>
                    <button type="submit">Export Data</button>
                </form>
                <div id="export-status" class="status-message" style="display: none;"></div>
            </div>

            <!-- Open File Section (Initially Hidden) -->
             <div id="open-file-section" class="content-section hidden">
                 <h2>Available Data Files (_data directory)</h2>
                 <div id="file-list-controls">
                     <label for="file-select-main">Select File:</label>
                     <select id="file-select-main" disabled>
                         <option value="">-- Loading files --</option>
                         <!-- Options populated by JS -->
                     </select>
                     <button id="refresh-files-btn">Refresh List</button>
                 </div>
                 <div id="file-list-status" class="status-message" style="display: none;"></div>
             </div>

            <!-- Data Preview Section (Central Area - Initially shows placeholder) -->
            <div id="preview-section" class="content-section">
                 <h2>Data Preview</h2>
                 <div id="preview-area" style="display: none;">
                     <p id="preview-filename" style="font-weight: bold;"></p>
                     <p id="preview-info"></p>
                     <div id="preview-table-container"></div>
                 </div>
                 <div id="preview-placeholder" style="text-align: center; padding: 20px; color: #666;">
                     Select a file using "Open File" to see a preview.
                 </div>
            </div>

            <!-- Clean Data Section (Initially Hidden) -->
            <div id="clean-data-section" class="content-section hidden">
                <h2>Clean Data File</h2>
                 <p>File: <strong id="clean-filename-display">No file selected</strong></p>
                 <div id="operations-builder">
                    <h4>Cleaning Operations</h4>
                    <div class="operation-controls">
                        <button id="add-remove-col-btn">Remove Column</button>
                        <button id="add-filter-btn">Filter Rows</button>
                        <button id="add-rename-col-btn">Rename Column</button>
                    </div>
                    <ul id="operations-list">
                        <!-- Operations added by JS -->
                    </ul>
                    <button id="execute-clean-button" disabled>Execute Cleaning</button>
                </div>
                <div id="clean-status" class="status-message" style="display: none;"></div>
            </div>

            <!-- Reformat Timestamps Section (Initially Hidden) -->
            <div id="reformat-time-section" class="content-section hidden">
                <h2>Reformat Timestamps</h2>
                 <p>File: <strong id="reformat-filename-display">No file selected</strong></p>
                 <div id="reformat-options">
                     <div>
                        <input type="checkbox" id="reformat-convert-tz-checkbox" name="convertTimezone">
                        <label for="reformat-convert-tz-checkbox">Convert Timezone?</label>
                    </div>
                     <div id="reformat-tz-input-div" style="display: none; margin-left: 20px; margin-bottom: 10px;">
                         <label for="reformat-target-tz">Target Timezone:</label>
                         <input type="text" id="reformat-target-tz" name="targetTimezone" placeholder="e.g., America/New_York, Europe/London">
                         <small>Common: America/New_York, America/Chicago, America/Denver, America/Los_Angeles, Europe/London, UTC</small>
                     </div>
                     <div>
                        <input type="checkbox" id="reformat-keep-time-only-checkbox" name="keepTimeOnly">
                        <label for="reformat-keep-time-only-checkbox">Keep Time Only (Remove Date)?</label>
                    </div>
                </div>
                <button id="execute-reformat-button" disabled>Reformat Timestamps</button>
                <div id="reformat-status" class="status-message" style="display: none;"></div>
            </div>

        </div>
    </div>

    <!-- Modals for Cleaning Operations (Keep these as they are for now) -->
    <div id="remove-col-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('remove-col-modal')">&times;</span>
            <h3>Remove Column</h3>
            <label for="remove-col-select">Column to Remove:</label>
            <select id="remove-col-select"></select>
            <button id="confirm-remove-col">Add Operation</button>
            <button onclick="closeModal('remove-col-modal')">Cancel</button>
        </div>
    </div>

    <div id="filter-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('filter-modal')">&times;</span>
            <h3>Filter Rows</h3>
            <label for="filter-col-select">Column:</label>
            <select id="filter-col-select"></select>
            <label for="filter-operator-select">Operator:</label>
            <select id="filter-operator-select">
                <option value="==">== (Equals)</option>
                <option value="!=">!= (Not Equals)</option>
                <option value=">">> (Greater Than)</option>
                <option value="<"> < (Less Than)</option>
                <option value=">=">>= (Greater Than or Equal)</option>
                <option value="<="><= (Less Than or Equal)</option>
            </select>
            <label for="filter-value-input">Value:</label>
            <input type="text" id="filter-value-input" placeholder="Enter value to filter by">
            <button id="confirm-filter">Add Operation</button>
            <button onclick="closeModal('filter-modal')">Cancel</button>
        </div>
    </div>

    <div id="rename-col-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('rename-col-modal')">&times;</span>
            <h3>Rename Column</h3>
            <label for="rename-col-select">Column to Rename:</label>
            <select id="rename-col-select"></select>
            <label for="rename-new-name-input">New Name:</label>
            <input type="text" id="rename-new-name-input" placeholder="Enter new column name">
            <button id="confirm-rename-col">Add Operation</button>
            <button onclick="closeModal('rename-col-modal')">Cancel</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
